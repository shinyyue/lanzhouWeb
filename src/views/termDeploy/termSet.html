<div id="source-manage-mylist" class="layui-fluid" lay-title="我的资源库">
	<div class="course-title">
		<div class="course-title-location">
			<span>您的位置：</span>
			<span>学期配置 > 学期设置</span>
		</div>
		<div class="course-title-search">
			<input type="text" value="请输入关键字" />
			<button class="search-confirm">
                <img src="src/images/search.png" />
            </button>
		</div>
	</div>
	<div class="course-add">
		<button class="primary-btn" id="add_term">添加</button>
	</div>
	<table id="term-mylist-table" lay-filter="term-mylist-table"></table>
	<script type="text/html" id="sourcelist-opt">
		<button class="course-set-btn" id="term-mylist-edit" onclick="">编辑</button>
		<button class="course-set-btn" id="term-mylist-delete">删除</button>
		<button class="course-set-btn" id="term-mylist-check">查看</button>
	</script>
	<div class="app-table-page" id="term-mylist-page"></div>
</div>

<script>
	layui.use(['table', 'jquery', 'form', 'tree', 'admin','laydate'], function(table, $) {
		var $ = layui.jquery,
			form = layui.form,
			laypage = layui.laypage,
			tableFilter = 'term-mylist-table',
			table = layui.table,
			admin = layui.admin,
			tree = layui.tree,
			layPageOption = {
				elem: 'term-mylist-page', //注意，这里的 test1 是 ID，不用加 # 号
				limit: 20,
				first: '首页',
				last: '尾页',
				layout: [
					'first',
					'prev',
					'page',
					'next',
					'last',
					'count',
					'currLimit',
					'curr',
					'pageCount'
				],
				jump: function(obj, first) {
					//首次不执行
					if(!first) {
						getList(obj.curr, obj.limit)
					}
				}

			},
			tableOption = {
				page: false,
				elem: '[lay-filter="' + tableFilter + '"]',
				cols: [
					[{
							title: '序号',
							field: 'id',
							width: 80,
							align: 'center'
						},
						{
							title: '学年',
							field: 'schoolYear',
							align: 'center'
						},
						{
							title: '学期',
							field: 'semester',
							align: 'center'
						},
						{
							title: '开始日期',
							field: 'startTime',
							align: 'center'
						},
						{
							title: '结束日期',
							field: 'endTime',
							align: 'center'
						},
						{
							title: '操作',
							align: 'center',
							templet: '#sourcelist-opt'
						}
					]
				]
			}

		getList(1, 20);

		addModalTemp =
			'<div id="college_details_modal">\n' +
			'        <form action="" class="layui-form">\n' +
			'            <div class="layui-row">\n' +
			'                <div class="layui-col-md12 layui-form-item">\n' +
			'                    <label class="layui-form-label">学期：</label>\n' +
			'                    <div class="layui-input-block">\n' +
			'                        <input\n' +
			'                            type="radio"\n' +
			'                            name="sex"\n' +
			'                            value="第1学期"\n' +
			'                            title="第1学期"\n' +
			'                        />\n' +
			'                        <input\n' +
			'                            type="radio"\n' +
			'                            name="sex"\n' +
			'                            value="第2学期"\n' +
			'                            title="第2学期"\n' +
			'                            checked\n' +
			'                        />\n' +
			'                    </div>\n' +
			'                </div>\n' +
			'            </div>\n' +
			'            <div class="layui-row">\n' +
			'                <div class="layui-col-md12 layui-form-item">\n' +
			'                    <label class="layui-form-label">开始日期:</label>\n' +
			'                    <input\n' +
			'                        type="text"\n' +
			'                        name="userName"\n' +
			'                        id="startTime"\n' +
			'                        class="common-form-input"\n' +
			'                        value="2018-09"\n' +
			'                    />\n' +
			'                </div>\n' +
			'            </div>\n' +
			'            <div class="layui-row">\n' +
			'                <div class="layui-col-md12 layui-form-item">\n' +
			'                    <label class="layui-form-label">结束日期:</label>\n' +
			'                    <input\n' +
			'                        type="text"\n' +
			'                        name="userName"\n' +
			'                        class="common-form-input"\n' +
			'                        value="2019-06"\n' +
			'                    />\n' +
			'                </div>\n' +
			'            </div>\n' +
			'            <div class="layui-row">\n' +
			'                <div class="layui-col-md12 layui-form-item">\n' +
			'                    <label class="layui-form-label">学年:</label>\n' +
			'                    <input\n' +
			'                        type="text"\n' +
			'                        name="userName"\n' +
			'                        class="common-form-input"\n' +
			'                        value="2018-2019"\n' +
			'                    />\n' +
			'                </div>\n' +
			'            </div>\n' +
			'        </form>\n' +
			'    </div>';
		admin.post({
            url: '/schoolYear/getList',
            data:JSON.stringify({"page":1,"rows":20,"key":"|||"}),
            success: function (res) {},
            error: function (err) {}
        })
		function getList(page, rows) {
			const data = {
				page: page,
				rows: rows
			}
			debugger;
			admin.post({
				url: '/schoolYear/getList',
				data: JSON.stringify(data),
				success: function(res) {
					tableOption.data = res.data.items;
					layPageOption.count = res.data.total;
					table.render(tableOption)
					laypage.render(layPageOption)
				},
				error: function(err) {
					console.log(err)
				}
			})
		}

		function addTerm() {
			//			const data = {
			//				termName: $('#termName').val(),
			//				menuPermissions: '1, 2, 3, 4, 5, 6'
			//			}
			const data = {
				"schoolYear": "202005-202009",
				"semester": 1,
				"startTime": 1557616760868,
				"endTime": 1557616760868
			}
			admin.post({
				url: '/schoolYear/add',
				data: JSON.stringify(data),
				success: function(res) {
					getList(1, 20);
					layer.msg('添加成功！')
				}
			})
		}

		function updateTerm() {
			//			const data = {
			//				termName: $('#termName').val(),
			//				menuPermissions: [1, 2, 3, 4, 5, 6]
			//			}
			const data = {
				"id":3,
				"schoolYear": "202005-202009",
				"semester": 1,
				"startTime": 1557616760868,
				"endTime": 1557616760868
			}
			admin.post({
				url: '/schoolYear/update',
				data: JSON.stringify(data),
				success: function(res) {
					console.log(22, res);
					getList(1, 20);
				}
			})
		}

		function deleteTerm() {
			const data = {
				// id: table.checkStatus('ID')
			}
			admin.delete({
				url: '/term/deleteTerm',
				data: JSON.stringify(data),
				success: function(res) {
					getList(1, 20);
				}
			})
		}

		function initLayerOpen() {
			layer.open({
				type: 1,
				offset: 'auto',
				title: '添加',
				content: addModalTemp,
				area: ['700px', '70%'],
				shade: 0.4,
				skin: 'user-edit-modal',
				shadeClose: true,
				btn: ['确定', '取消'],
				yes: function(index, layero) {
					// 提交
					// $('#showId').val()
					// $('#term-remark').val()
					addTerm()
					layer.close(index)
				},
				cancel: function(index) {
					layer.close(index)
				}
			})
			form.render()
		}

		function getMenuList(callback) {
			const data = {
				page: 1,
				rows: 100
			}
			admin.post({
				url: '/menu/getList',
				data: JSON.stringify(data),
				success: function(res) {
					callback(res.data.items)
				}
			})
		}

		$('#add_term').on('click', function() {
			initLayerOpen()
			//清空form表单
			$('#termName').val('')
			$('#usName').val('')
			$('#showId').val('')
			$('#term-remark').val('')
			// 渲染权限列表
			getMenuList(function(list) {
				// tree.render({
				//     elem: '#test7',
				//     data: [{
				//         title: 'test'
				//     }, {
				//         title: 'use'
				//     }],
				//     showCheckbox: true
				// })
			})
		})

		$('#term-mylist-delete').on('click', function() {
			layer.open({
				type: 1,
				offset: 'auto',
				title: '系统提示',
				content: '该信息为重要信息，是否删除？',
				area: ['300px', '200px'],
				shade: 0.4,
				skin: 'system-modal',
				shadeClose: true,
				btn: ['确定', '取消'],
				yes: function(index, layero) {
					// 提交
					layer.close(index)
				},
				cancel: function(index) {
					layer.close(index)
				}
			})
		})
		var edit_id;
		var term-mylist-edit =  function(id) {
			console.log(111111)
			edit_id = id;
			initLayerOpen()
			// layer.open({
			//     type: 1,
			//     offset: 'auto',
			//     title: '编辑',
			//     content: addModalTemp,
			//     area: ['700px', '70%'],
			//     shade: 0.4,
			//     skin: 'term-edit-modal',
			//     shadeClose: true,
			//     btn: ['确定', '取消'],
			//     yes: function (index, layero) {
			//         // 提交
			//         layer.close(index)
			//     },
			//     cancel: function (index) {
			//         layer.close(index)
			//     }
			// })
			// form.render()
		};

		$('#term-mylist-edit').on('click', function() {
			console.log(111111)
			initLayerOpen()
			// layer.open({
			//     type: 1,
			//     offset: 'auto',
			//     title: '编辑',
			//     content: addModalTemp,
			//     area: ['700px', '70%'],
			//     shade: 0.4,
			//     skin: 'term-edit-modal',
			//     shadeClose: true,
			//     btn: ['确定', '取消'],
			//     yes: function (index, layero) {
			//         // 提交
			//         layer.close(index)
			//     },
			//     cancel: function (index) {
			//         layer.close(index)
			//     }
			// })
			// form.render()
		})

		$('#term-mylist-check').on('click', function() {
			layer.open({
				type: 1,
				offset: 'auto',
				title: '编辑',
				content: addModalTemp,
				area: ['700px', '70%'],
				shade: 0.4,
				skin: 'term-edit-modal',
				shadeClose: true,
				btn: ['确定', '取消'],
				yes: function(index, layero) {
					// 提交
					layer.close(index)
				},
				cancel: function(index) {
					layer.close(index)
				}
			})
			form.render()
		})

	})
</script>

<style>
	#source-manage-mylist {}
	
	.term-edit-modal .layui-layer-content {
		padding: 20px;
	}
	
	.term-remark {
		width: 63%;
	}
</style>